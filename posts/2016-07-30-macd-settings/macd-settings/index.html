<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MACD Settings &mdash; backtrader  documentation</title>
    
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/sphinxcontrib-images\LightBox2\lightbox2\css\lightbox.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/sphinxcontrib-images\LightBox2\lightbox2\js\jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../_static/sphinxcontrib-images\LightBox2\lightbox2\js\lightbox.min.js"></script>
    <script type="text/javascript" src="../../../_static/sphinxcontrib-images\LightBox2\lightbox2-customize\jquery-noconflict.js"></script>
    <link rel="author" title="About these documents" href="../../../about/" />
    <link rel="top" title="backtrader  documentation" href="../../../" />
  
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  
  
  <link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet">
  
  <style type="text/css">
    ul.ablog-archive {list-style: none; overflow: auto; margin-left: 0px}
    ul.ablog-archive li {float: left; margin-right: 5px; font-size: 80%}
    ul.post-list-style-disc {list-style-type: disc;}
    ul.post-list-style-none {list-style-type: none;}
    ul.post-list-style-circle {list-style-type: circle;}
  </style>

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="macd-settings">
<h1>MACD Settings<a class="headerlink" href="#macd-settings" title="Permalink to this headline">¶</a></h1>
<p>In the <em>Algotrading</em> site of <em>Reddit</em> I found the following thread:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="https://www.reddit.com/r/algotrading/comments/4s832w/how_to_determine_best_macd_settings/">How to determine best MACD settings?</a></li>
</ul>
</div></blockquote>
<p>Having started the <em>backtrader</em> quest because of <a class="reference external" href="https://www.amazon.com/Trade-Your-Way-Financial-Freedom/dp/007147871X">Trading Your Way To Financial
Freedom - Amazon Link</a> I had
no other choice but to post an answer and craft a sample.</p>
<p>The strategy approach is loosely based on some of the ideas presented in the
book. Nothing new under the sun. And the parameters have been quickly set. No
overfitting, no optimization, no nothing. Roughly:</p>
<blockquote>
<div><ul class="simple">
<li>Enter if the <code class="docutils literal"><span class="pre">macd</span></code> line crosses the <code class="docutils literal"><span class="pre">signal</span></code> line to the upside and a
control <code class="docutils literal"><span class="pre">Simple</span> <span class="pre">Moving</span> <span class="pre">Average</span></code> has had a net negative direction in the
last x periods (current <em>SMA</em> value below the value <em>x</em> periods ago)</li>
<li>Set a <code class="docutils literal"><span class="pre">stop</span></code> price <code class="docutils literal"><span class="pre">N</span> <span class="pre">x</span> <span class="pre">ATR</span></code> times away from the <code class="docutils literal"><span class="pre">close</span></code> price</li>
<li>Exit the market if the <code class="docutils literal"><span class="pre">close</span></code> price goes below the <code class="docutils literal"><span class="pre">stop</span></code> price</li>
<li>If still in the market, update the <code class="docutils literal"><span class="pre">stop</span></code> price only if it&#8217;s greater than
the actual one</li>
</ul>
</div></blockquote>
<p>The staking is done by:</p>
<blockquote>
<div><ul class="simple">
<li>Having a <code class="docutils literal"><span class="pre">Sizer</span></code> allocate a <em>percentage</em> of the available cash to the
operation. The more the strategy wins, the more it stakes ... and the more
it loses the less it stakes.</li>
</ul>
</div></blockquote>
<p>There is a <em>commision</em> included. Because the tests will be done with <em>stocks</em> a
percentage commission has been chosen with a value <code class="docutils literal"><span class="pre">0.0033</span></code> (aka <code class="docutils literal"><span class="pre">0.33%</span></code>
per round trip.</p>
<p>To put this into play, there will be 3 runs with 3 datas (for a total of 9
runs)</p>
<blockquote>
<div><ol class="arabic simple">
<li>The standard parameters which have been chosen manually</li>
<li>Increase cash allocation perentage from <code class="docutils literal"><span class="pre">0.20</span></code> to <code class="docutils literal"><span class="pre">0.50</span></code></li>
<li>Increase ATR distance for the stop from <code class="docutils literal"><span class="pre">3.0</span></code> to <code class="docutils literal"><span class="pre">4.0</span></code> to try to avoid
being whipped</li>
</ol>
</div></blockquote>
<p>The manually chosen parameters for the strategy:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">params</span> <span class="o">=</span> <span class="p">(</span>
    <span class="c1"># Standard MACD Parameters</span>
    <span class="p">(</span><span class="s1">&#39;macd1&#39;</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;macd2&#39;</span><span class="p">,</span> <span class="mi">26</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;macdsig&#39;</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;atrperiod&#39;</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span>  <span class="c1"># ATR Period (standard)</span>
    <span class="p">(</span><span class="s1">&#39;atrdist&#39;</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">),</span>   <span class="c1"># ATR distance for stop price</span>
    <span class="p">(</span><span class="s1">&#39;smaperiod&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>  <span class="c1"># SMA Period (pretty standard)</span>
    <span class="p">(</span><span class="s1">&#39;dirperiod&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>  <span class="c1"># Lookback period to consider SMA trend direction</span>
<span class="p">)</span>
</pre></div>
</div>
<p>And system wide:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--cash&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Cash to start with&#39;</span><span class="p">))</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--cashalloc&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.20</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Perc (abs) of cash to allocate for ops&#39;</span><span class="p">))</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--commperc&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.0033</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Perc (abs) commision in each operation. &#39;</span>
                          <span class="s1">&#39;0.001 -&gt; 0.1</span><span class="si">%%</span><span class="s1">, 0.01 -&gt; 1</span><span class="si">%%</span><span class="s1">&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>The date range will be from <code class="docutils literal"><span class="pre">2005-01-01</span></code> to <code class="docutils literal"><span class="pre">2014-12-31</span></code> for a total of 10
years.</p>
<div class="section" id="analyzers">
<h2>Analyzers<a class="headerlink" href="#analyzers" title="Permalink to this headline">¶</a></h2>
<p>To get some <em>objective</em> data 3 analyzers will be added to the system:</p>
<blockquote>
<div><ul>
<li><p class="first">Two <code class="docutils literal"><span class="pre">TimeReturn</span></code> for the entire period</p>
<ol class="arabic simple">
<li>For the strategy itself</li>
<li>For the data being operated upon as benchmark</li>
</ol>
<p>Effectively benchmarking the strategy against the asset</p>
</li>
<li><p class="first">A <code class="docutils literal"><span class="pre">TimeReturn</span></code> to measure <em>annual returns</em></p>
</li>
<li><p class="first">A <code class="docutils literal"><span class="pre">SharpeRatio</span></code> to see how the strategy performs against a risk-free
asset</p>
<p>The value is set at <code class="docutils literal"><span class="pre">1%</span></code>, can be changed with the sample options</p>
</li>
<li><p class="first">A <code class="docutils literal"><span class="pre">SQN</span></code> (<em>System Quality Number</em>) to analyze the quality of the trades
using this performance indicator defined by Van K. Tharp</p>
</li>
</ul>
</div></blockquote>
<p>Additonally a <code class="docutils literal"><span class="pre">DrawDown</span></code> observer will be added to the mix.</p>
</div>
<div class="section" id="run-1-standard-parameters">
<h2>Run 1: Standard Parameters<a class="headerlink" href="#run-1-standard-parameters" title="Permalink to this headline">¶</a></h2>
<div class="section" id="yhoo">
<h3>YHOO<a class="headerlink" href="#yhoo" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./macdsystem.py --plot --dataset yhoo
===============================================================================
TimeReturn:
  - 9999-12-31 23:59:59.999999: -0.07118518868
===============================================================================
TimeReturn:
  - 9999-12-31 23:59:59.999999: 0.316736183525
===============================================================================
TimeReturn:
  - 2005-12-31: 0.02323119024
  - 2006-12-31: -0.0813678018166
  - 2007-12-31: -0.0144802141955
  - 2008-12-31: -0.142301023804
  - 2009-12-31: 0.0612152927491
  - 2010-12-31: 0.00898269987778
  - 2011-12-31: -0.00845048588578
  - 2012-12-31: 0.0541362123146
  - 2013-12-31: 0.0158705967774
  - 2014-12-31: 0.0281978956007
===============================================================================
SharpeRatio:
  - sharperatio: -0.261214264357
===============================================================================
SQN:
  - sqn: -0.784558216044
  - trades: 45
</pre></div>
</div>
<a class=""
               data-lightbox="group-67e4ed85-6d5a-4f5a-b55a-e5ad2014d9f5"
               href="../../../_images/yhoo-run011.png"
               title=""
               data-title=""
               ><img src="../../../_images/yhoo-run011.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a></div>
<div class="section" id="orcl">
<h3>ORCL<a class="headerlink" href="#orcl" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./macdsystem.py --plot --dataset orcl
===============================================================================
TimeReturn:
  - 9999-12-31 23:59:59.999999: 0.24890384718
===============================================================================
TimeReturn:
  - 9999-12-31 23:59:59.999999: 2.23991354467
===============================================================================
TimeReturn:
  - 2005-12-31: -0.02372911952
  - 2006-12-31: 0.0692563226579
  - 2007-12-31: 0.0551086853554
  - 2008-12-31: -0.026707886256
  - 2009-12-31: 0.0786118091383
  - 2010-12-31: 0.037571919146
  - 2011-12-31: 0.00846519206845
  - 2012-12-31: 0.0402937469005
  - 2013-12-31: -0.0147124502187
  - 2014-12-31: 0.00710131291379
===============================================================================
SharpeRatio:
  - sharperatio: 0.359712552054
===============================================================================
SQN:
  - sqn: 1.76240859868
  - trades: 37
</pre></div>
</div>
<a class=""
               data-lightbox="group-ded2ad3b-b2ee-48fa-8bbb-d12fa883c1e3"
               href="../../../_images/orcl-run011.png"
               title=""
               data-title=""
               ><img src="../../../_images/orcl-run011.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a></div>
<div class="section" id="nvda">
<h3>NVDA<a class="headerlink" href="#nvda" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./macdsystem.py --plot --dataset nvda
===============================================================================
TimeReturn:
  - 9999-12-31 23:59:59.999999: -0.0178507058999
===============================================================================
TimeReturn:
  - 9999-12-31 23:59:59.999999: -0.177604931253
===============================================================================
TimeReturn:
  - 2005-12-31: 0.0773031957141
  - 2006-12-31: 0.105007457325
  - 2007-12-31: 0.015286423657
  - 2008-12-31: -0.109130552525
  - 2009-12-31: 0.14716076542
  - 2010-12-31: -0.0891638005423
  - 2011-12-31: -0.0788216550171
  - 2012-12-31: -0.0498231953066
  - 2013-12-31: -0.0119166712361
  - 2014-12-31: 0.00940493597076
===============================================================================
SharpeRatio:
  - sharperatio: -0.102967601564
===============================================================================
SQN:
  - sqn: -0.0700412395071
  - trades: 38
</pre></div>
</div>
<a class=""
               data-lightbox="group-b6a9c7a3-e52a-4f72-9f15-c0160107d6a2"
               href="../../../_images/nvda-run011.png"
               title=""
               data-title=""
               ><img src="../../../_images/nvda-run011.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a></div>
<div class="section" id="analysis-of-run-1">
<h3>Analysis of Run 1<a class="headerlink" href="#analysis-of-run-1" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul>
<li><p class="first"><em>YHOO</em></p>
<p>The 1st and 2nd <code class="docutils literal"><span class="pre">TimeReturn</span></code> analyzers (the strategy and the asset itself)
show that The strategy has lost <code class="docutils literal"><span class="pre">7.11%</span></code> whilst the asset in question has
appreciated <code class="docutils literal"><span class="pre">31.67%</span></code>.</p>
<p>Not even worth having a look at the other analyzers</p>
</li>
<li><p class="first"><em>ORCL</em></p>
<p>A <code class="docutils literal"><span class="pre">24.89%</span></code> for the strategy, but paled by the <code class="docutils literal"><span class="pre">223.99%</span></code> return of the
asset itself.</p>
<p>The <em>SharpeRatio</em> at <code class="docutils literal"><span class="pre">0.35</span></code> is still away from the usual minimum target of
<code class="docutils literal"><span class="pre">1</span></code>.</p>
<p>The <em>SQN</em> returns a <code class="docutils literal"><span class="pre">1.76</span></code> which at least gets a grading in the
<em>Van K. Tharp</em> scale: <code class="docutils literal"><span class="pre">1.6</span> <span class="pre">-</span> <span class="pre">1.9</span> <span class="pre">Below</span> <span class="pre">Average</span></code>.</p>
</li>
<li><p class="first"><em>NVDA</em></p>
<p>In this case a <code class="docutils literal"><span class="pre">-1.78%</span></code> for the strategy and a <code class="docutils literal"><span class="pre">-17.76%</span></code> for the
asset. The SharpeRatio, with <code class="docutils literal"><span class="pre">-0.10</span></code> shows that even if the strategy has
outperformed the asset, it would have been better to go with a <code class="docutils literal"><span class="pre">1%</span></code> bank
account.</p>
<p>The <em>SQN</em> is obviously not even at the bottom of the scale.</p>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="conclusions-of-run-1">
<h3>Conclusions of Run 1<a class="headerlink" href="#conclusions-of-run-1" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li><em>1 great loss, a tie and a win which underperforms the asset</em>. Not that successful.</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="run-2-cashalloc-to-0-50">
<h2>Run 2: CashAlloc to 0.50<a class="headerlink" href="#run-2-cashalloc-to-0-50" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3>YHOO<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./macdsystem.py --plot --dataset yhoo --cashalloc 0.50
===============================================================================
TimeReturn:
  - 9999-12-31 23:59:59.999999: -0.20560369198
===============================================================================
TimeReturn:
  - 9999-12-31 23:59:59.999999: 0.316736183525
===============================================================================
TimeReturn:
  - 2005-12-31: 0.05517338686
  - 2006-12-31: -0.195123836162
  - 2007-12-31: -0.0441556438731
  - 2008-12-31: -0.32426212721
  - 2009-12-31: 0.153876836394
  - 2010-12-31: 0.0167157437151
  - 2011-12-31: -0.0202891373759
  - 2012-12-31: 0.13289763017
  - 2013-12-31: 0.0408192946307
  - 2014-12-31: 0.0685527133815
===============================================================================
SharpeRatio:
  - sharperatio: -0.154427699146
===============================================================================
SQN:
  - sqn: -0.97846453428
  - trades: 45
</pre></div>
</div>
<a class=""
               data-lightbox="group-195b9bbf-c1db-4680-a5f7-d51505273a87"
               href="../../../_images/yhoo-run021.png"
               title=""
               data-title=""
               ><img src="../../../_images/yhoo-run021.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a></div>
<div class="section" id="id2">
<h3>ORCL<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./macdsystem.py --plot --dataset orcl --cashalloc 0.50
===============================================================================
TimeReturn:
  - 9999-12-31 23:59:59.999999: 0.69016747856
===============================================================================
TimeReturn:
  - 9999-12-31 23:59:59.999999: 2.23991354467
===============================================================================
TimeReturn:
  - 2005-12-31: -0.0597533502
  - 2006-12-31: 0.176988400688
  - 2007-12-31: 0.140268851352
  - 2008-12-31: -0.0685193675128
  - 2009-12-31: 0.195760054561
  - 2010-12-31: 0.0956386594392
  - 2011-12-31: 0.018709882089
  - 2012-12-31: 0.100122407053
  - 2013-12-31: -0.0375741196261
  - 2014-12-31: 0.017570390931
===============================================================================
SharpeRatio:
  - sharperatio: 0.518921692742
===============================================================================
SQN:
  - sqn: 1.68844251174
  - trades: 37
</pre></div>
</div>
<a class=""
               data-lightbox="group-32b47ba1-7012-42c9-bd43-8ad64502c0f9"
               href="../../../_images/orcl-run021.png"
               title=""
               data-title=""
               ><img src="../../../_images/orcl-run021.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a></div>
<div class="section" id="id3">
<h3>NVDA<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./macdsystem.py --plot --dataset nvda --cashalloc 0.50
===============================================================================
TimeReturn:
  - 9999-12-31 23:59:59.999999: -0.128845648113
===============================================================================
TimeReturn:
  - 9999-12-31 23:59:59.999999: -0.177604931253
===============================================================================
TimeReturn:
  - 2005-12-31: 0.200593209479
  - 2006-12-31: 0.219254906522
  - 2007-12-31: 0.0407793562989
  - 2008-12-31: -0.259567975403
  - 2009-12-31: 0.380971100974
  - 2010-12-31: -0.208860409742
  - 2011-12-31: -0.189068154062
  - 2012-12-31: -0.122095056225
  - 2013-12-31: -0.0296495770432
  - 2014-12-31: 0.0232050942344
===============================================================================
SharpeRatio:
  - sharperatio: -0.0222780544339
===============================================================================
SQN:
  - sqn: -0.190661428812
  - trades: 38
</pre></div>
</div>
<a class=""
               data-lightbox="group-02f8fcf7-64ac-4e5a-9060-c84d372926ff"
               href="../../../_images/nvda-run021.png"
               title=""
               data-title=""
               ><img src="../../../_images/nvda-run021.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a></div>
<div class="section" id="conclusions-of-run-2">
<h3>Conclusions of Run 2<a class="headerlink" href="#conclusions-of-run-2" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>Increasing the percentage cash allocation in each operation from <code class="docutils literal"><span class="pre">20%</span></code> to
<code class="docutils literal"><span class="pre">50%</span></code> has increased the effect of the previous results<ul>
<li>The strategy on <em>YHOO</em> and <em>NVDA</em> has lost more than before</li>
<li>And the strategy on <em>ORCL</em> has won more than before, still not close to
the over <em>220%</em> of the asset.</li>
</ul>
</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="run-3-atr-distance-to-4-0">
<h2>Run 3: ATR Distance to 4.0<a class="headerlink" href="#run-3-atr-distance-to-4-0" title="Permalink to this headline">¶</a></h2>
<p>Still keeping the previous increase in cash allocation to <code class="docutils literal"><span class="pre">50%</span></code>. The idea is
to avoid getting too early out of the market.</p>
<div class="section" id="id4">
<h3>YHOO<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./macdsystem.py --plot --dataset yhoo --cashalloc 0.50 --atrdist 4.0
===============================================================================
TimeReturn:
  - 9999-12-31 23:59:59.999999: 0.01196310622
===============================================================================
TimeReturn:
  - 9999-12-31 23:59:59.999999: 0.316736183525
===============================================================================
TimeReturn:
  - 2005-12-31: 0.06476232676
  - 2006-12-31: -0.220219327475
  - 2007-12-31: -0.0525484648039
  - 2008-12-31: -0.314772526784
  - 2009-12-31: 0.179631995594
  - 2010-12-31: 0.0579495723922
  - 2011-12-31: -0.0248948026947
  - 2012-12-31: 0.10922621981
  - 2013-12-31: 0.406711050602
  - 2014-12-31: -0.0113108751022
===============================================================================
SharpeRatio:
  - sharperatio: 0.0495181271704
===============================================================================
SQN:
  - sqn: -0.211652416441
  - trades: 33
</pre></div>
</div>
<a class=""
               data-lightbox="group-12e5c6e9-f520-48d6-ae38-4b38e4454359"
               href="../../../_images/yhoo-run031.png"
               title=""
               data-title=""
               ><img src="../../../_images/yhoo-run031.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a></div>
<div class="section" id="id5">
<h3>ORCL<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./macdsystem.py --plot --dataset orcl --cashalloc 0.50 --atrdist 4.0
===============================================================================
TimeReturn:
  - 9999-12-31 23:59:59.999999: 0.21907748452
===============================================================================
TimeReturn:
  - 9999-12-31 23:59:59.999999: 2.23991354467
===============================================================================
TimeReturn:
  - 2005-12-31: -0.06660102614
  - 2006-12-31: 0.169334910265
  - 2007-12-31: 0.10620478758
  - 2008-12-31: -0.167615289704
  - 2009-12-31: 0.17616784045
  - 2010-12-31: 0.0591200431984
  - 2011-12-31: -0.100238247103
  - 2012-12-31: 0.135096589522
  - 2013-12-31: -0.0630483842399
  - 2014-12-31: 0.0175914485158
===============================================================================
SharpeRatio:
  - sharperatio: 0.144210776122
===============================================================================
SQN:
  - sqn: 0.646519270815
  - trades: 30
</pre></div>
</div>
<a class=""
               data-lightbox="group-cd03b815-75a8-4d74-bde7-b662096261db"
               href="../../../_images/orcl-run031.png"
               title=""
               data-title=""
               ><img src="../../../_images/orcl-run031.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a></div>
<div class="section" id="id6">
<h3>NVDA<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./macdsystem.py --plot --dataset nvda --cashalloc 0.50 --atrdist 4.0
===============================================================================
TimeReturn:
  - 9999-12-31 23:59:59.999999: 0.48840287049
===============================================================================
TimeReturn:
  - 9999-12-31 23:59:59.999999: -0.177604931253
===============================================================================
TimeReturn:
  - 2005-12-31: 0.246510998277
  - 2006-12-31: 0.194958106054
  - 2007-12-31: -0.123140650516
  - 2008-12-31: -0.246174938322
  - 2009-12-31: 0.33121185861
  - 2010-12-31: -0.0442212647256
  - 2011-12-31: 0.0368388717861
  - 2012-12-31: -0.048473112136
  - 2013-12-31: 0.10657587649
  - 2014-12-31: 0.0883112536534
===============================================================================
SharpeRatio:
  - sharperatio: 0.264551262551
===============================================================================
SQN:
  - sqn: 0.564151633588
  - trades: 29
</pre></div>
</div>
<a class=""
               data-lightbox="group-69d9004c-c120-4087-ab47-819e1ce8602c"
               href="../../../_images/nvda-run031.png"
               title=""
               data-title=""
               ><img src="../../../_images/nvda-run031.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a></div>
<div class="section" id="conclusions-of-run-3">
<h3>Conclusions of Run 3<a class="headerlink" href="#conclusions-of-run-3" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul>
<li><p class="first"><strong>Chicken, Chicken, Winner Dinner!!</strong></p>
<p>The strategy makes money on the 3 assets</p>
<ul>
<li><p class="first"><em>YHOO</em>: <code class="docutils literal"><span class="pre">1.19%</span></code> vs the <code class="docutils literal"><span class="pre">31.67%</span></code> return of the asset itself</p>
</li>
<li><p class="first"><em>ORCL</em>: <code class="docutils literal"><span class="pre">21.90%</span></code> vs the <code class="docutils literal"><span class="pre">223.99%</span></code> of the asset</p>
<p>In this case increasing the <code class="docutils literal"><span class="pre">ATRDist</span></code> parameter has decreased the
previous returns of <em>Run 2</em> which were at <code class="docutils literal"><span class="pre">69.01%</span></code></p>
</li>
<li><p class="first"><em>NVDA</em>: <code class="docutils literal"><span class="pre">48.84%</span></code> vs <code class="docutils literal"><span class="pre">-17.76%</span></code> of the asset.</p>
<p>The surprising thing here is that the <em>SharpRatio</em> and <em>SQN</em> are telling
that</p>
</li>
</ul>
</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="usage-of-the-sample">
<h2>Usage of the sample<a class="headerlink" href="#usage-of-the-sample" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./macdsystem.py --help
usage: macdsystem.py [-h] (--data DATA | --dataset {yhoo,orcl,nvda})
                     [--fromdate FROMDATE] [--todate TODATE] [--cash CASH]
                     [--cashalloc CASHALLOC] [--commperc COMMPERC]
                     [--macd1 MACD1] [--macd2 MACD2] [--macdsig MACDSIG]
                     [--atrperiod ATRPERIOD] [--atrdist ATRDIST]
                     [--smaperiod SMAPERIOD] [--dirperiod DIRPERIOD]
                     [--riskfreerate RISKFREERATE] [--plot [kwargs]]

Sample for Tharp example with MACD

optional arguments:
  -h, --help            show this help message and exit
  --data DATA           Specific data to be read in (default: None)
  --dataset {yhoo,orcl,nvda}
                        Choose one of the predefined data sets (default: None)
  --fromdate FROMDATE   Starting date in YYYY-MM-DD format (default:
                        2005-01-01)
  --todate TODATE       Ending date in YYYY-MM-DD format (default: None)
  --cash CASH           Cash to start with (default: 50000)
  --cashalloc CASHALLOC
                        Perc (abs) of cash to allocate for ops (default: 0.2)
  --commperc COMMPERC   Perc (abs) commision in each operation. 0.001 -&gt; 0.1%,
                        0.01 -&gt; 1% (default: 0.0033)
  --macd1 MACD1         MACD Period 1 value (default: 12)
  --macd2 MACD2         MACD Period 2 value (default: 26)
  --macdsig MACDSIG     MACD Signal Period value (default: 9)
  --atrperiod ATRPERIOD
                        ATR Period To Consider (default: 14)
  --atrdist ATRDIST     ATR Factor for stop price calculation (default: 3.0)
  --smaperiod SMAPERIOD
                        Period for the moving average (default: 30)
  --dirperiod DIRPERIOD
                        Period for SMA direction calculation (default: 10)
  --riskfreerate RISKFREERATE
                        Risk free rate in Perc (abs) of the asset for the
                        Sharpe Ratio (default: 0.01)
  --plot [kwargs], -p [kwargs]
                        Plot the read data applying any kwargs passed For
                        example: --plot style=&quot;candle&quot; (to plot candles)
                        (default: None)
</pre></div>
</div>
</div>
<div class="section" id="and-the-code-itself">
<h2>And the code itself<a class="headerlink" href="#and-the-code-itself" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="p">(</span><span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span>
                        <span class="n">unicode_literals</span><span class="p">)</span>


<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="kn">import</span> <span class="nn">backtrader</span> <span class="kn">as</span> <span class="nn">bt</span>

<span class="n">BTVERSION</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">bt</span><span class="o">.</span><span class="n">__version__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">FixedPerc</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">Sizer</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;This sizer simply returns a fixed size for any operation</span>

<span class="sd">    Params:</span>
<span class="sd">      - ``perc`` (default: ``0.20``) Perc of cash to allocate for operation</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">params</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s1">&#39;perc&#39;</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">),</span>  <span class="c1"># perc of cash to use for operation</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_getsizing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comminfo</span><span class="p">,</span> <span class="n">cash</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">isbuy</span><span class="p">):</span>
        <span class="n">cashtouse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">perc</span> <span class="o">*</span> <span class="n">cash</span>
        <span class="k">if</span> <span class="n">BTVERSION</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">93</span><span class="p">):</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">comminfo</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">close</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cashtouse</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">cashtouse</span> <span class="o">//</span> <span class="n">data</span><span class="o">.</span><span class="n">close</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">size</span>


<span class="k">class</span> <span class="nc">TheStrategy</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This strategy is loosely based on some of the examples from the Van</span>
<span class="sd">    K. Tharp book: *Trade Your Way To Financial Freedom*. The logic:</span>

<span class="sd">      - Enter the market if:</span>
<span class="sd">        - The MACD.macd line crosses the MACD.signal line to the upside</span>
<span class="sd">        - The Simple Moving Average has a negative direction in the last x</span>
<span class="sd">          periods (actual value below value x periods ago)</span>

<span class="sd">     - Set a stop price x times the ATR value away from the close</span>

<span class="sd">     - If in the market:</span>

<span class="sd">       - Check if the current close has gone below the stop price. If yes,</span>
<span class="sd">         exit.</span>
<span class="sd">       - If not, update the stop price if the new stop price would be higher</span>
<span class="sd">         than the current</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">params</span> <span class="o">=</span> <span class="p">(</span>
        <span class="c1"># Standard MACD Parameters</span>
        <span class="p">(</span><span class="s1">&#39;macd1&#39;</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;macd2&#39;</span><span class="p">,</span> <span class="mi">26</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;macdsig&#39;</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;atrperiod&#39;</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span>  <span class="c1"># ATR Period (standard)</span>
        <span class="p">(</span><span class="s1">&#39;atrdist&#39;</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">),</span>   <span class="c1"># ATR distance for stop price</span>
        <span class="p">(</span><span class="s1">&#39;smaperiod&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>  <span class="c1"># SMA Period (pretty standard)</span>
        <span class="p">(</span><span class="s1">&#39;dirperiod&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>  <span class="c1"># Lookback period to consider SMA trend direction</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">notify_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">order</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">order</span><span class="o">.</span><span class="n">Completed</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">order</span><span class="o">.</span><span class="n">alive</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c1"># indicate no order is pending</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">macd</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">indicators</span><span class="o">.</span><span class="n">MACD</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                       <span class="n">period_me1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">macd1</span><span class="p">,</span>
                                       <span class="n">period_me2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">macd2</span><span class="p">,</span>
                                       <span class="n">period_signal</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">macdsig</span><span class="p">)</span>

        <span class="c1"># Cross of macd.macd and macd.signal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mcross</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">indicators</span><span class="o">.</span><span class="n">CrossOver</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">macd</span><span class="o">.</span><span class="n">macd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">macd</span><span class="o">.</span><span class="n">signal</span><span class="p">)</span>

        <span class="c1"># To set the stop price</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atr</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">indicators</span><span class="o">.</span><span class="n">ATR</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">atrperiod</span><span class="p">)</span>

        <span class="c1"># Control market trend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sma</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">indicators</span><span class="o">.</span><span class="n">SMA</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">smaperiod</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smadir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sma</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">sma</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">dirperiod</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c1"># sentinel to avoid operrations on pending order</span>

    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">:</span>
            <span class="k">return</span>  <span class="c1"># pending order execution</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">:</span>  <span class="c1"># not in the market</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcross</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">smadir</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buy</span><span class="p">()</span>
                <span class="n">pdist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">atrdist</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pstop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">close</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pdist</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># in the market</span>
            <span class="n">pclose</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">close</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">pstop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pstop</span>

            <span class="k">if</span> <span class="n">pclose</span> <span class="o">&lt;</span> <span class="n">pstop</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># stop met - get out</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pdist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">atrdist</span>
                <span class="c1"># Update only if greater than</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pstop</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">pstop</span><span class="p">,</span> <span class="n">pclose</span> <span class="o">-</span> <span class="n">pdist</span><span class="p">)</span>


<span class="n">DATASETS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;yhoo&#39;</span><span class="p">:</span> <span class="s1">&#39;../../datas/yhoo-1996-2014.txt&#39;</span><span class="p">,</span>
    <span class="s1">&#39;orcl&#39;</span><span class="p">:</span> <span class="s1">&#39;../../datas/orcl-1995-2014.txt&#39;</span><span class="p">,</span>
    <span class="s1">&#39;nvda&#39;</span><span class="p">:</span> <span class="s1">&#39;../../datas/nvda-1999-2014.txt&#39;</span><span class="p">,</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">runstrat</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

    <span class="n">cerebro</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Cerebro</span><span class="p">()</span>
    <span class="n">cerebro</span><span class="o">.</span><span class="n">broker</span><span class="o">.</span><span class="n">set_cash</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">cash</span><span class="p">)</span>
    <span class="n">comminfo</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">commissions</span><span class="o">.</span><span class="n">CommInfo_Stocks_Perc</span><span class="p">(</span><span class="n">commission</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">commperc</span><span class="p">,</span>
                                                   <span class="n">percabs</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">cerebro</span><span class="o">.</span><span class="n">broker</span><span class="o">.</span><span class="n">addcommissioninfo</span><span class="p">(</span><span class="n">comminfo</span><span class="p">)</span>

    <span class="n">dkwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">fromdate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fromdate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">fromdate</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">dkwargs</span><span class="p">[</span><span class="s1">&#39;fromdate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fromdate</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">todate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">todate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">todate</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">dkwargs</span><span class="p">[</span><span class="s1">&#39;todate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">todate</span>

    <span class="c1"># if dataset is None, args.data has been given</span>
    <span class="n">dataname</span> <span class="o">=</span> <span class="n">DATASETS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">dataset</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">data0</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">feeds</span><span class="o">.</span><span class="n">BacktraderCSVData</span><span class="p">(</span><span class="n">dataname</span><span class="o">=</span><span class="n">dataname</span><span class="p">,</span> <span class="o">**</span><span class="n">dkwargs</span><span class="p">)</span>
    <span class="n">cerebro</span><span class="o">.</span><span class="n">adddata</span><span class="p">(</span><span class="n">data0</span><span class="p">)</span>

    <span class="n">cerebro</span><span class="o">.</span><span class="n">addstrategy</span><span class="p">(</span><span class="n">TheStrategy</span><span class="p">,</span>
                        <span class="n">macd1</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">macd1</span><span class="p">,</span> <span class="n">macd2</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">macd2</span><span class="p">,</span>
                        <span class="n">macdsig</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">macdsig</span><span class="p">,</span>
                        <span class="n">atrperiod</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">atrperiod</span><span class="p">,</span>
                        <span class="n">atrdist</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">atrdist</span><span class="p">,</span>
                        <span class="n">smaperiod</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">smaperiod</span><span class="p">,</span>
                        <span class="n">dirperiod</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">dirperiod</span><span class="p">)</span>

    <span class="n">cerebro</span><span class="o">.</span><span class="n">addsizer</span><span class="p">(</span><span class="n">FixedPerc</span><span class="p">,</span> <span class="n">perc</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">cashalloc</span><span class="p">)</span>

    <span class="c1"># Add TimeReturn Analyzers for self and the benchmark data</span>
    <span class="n">cerebro</span><span class="o">.</span><span class="n">addanalyzer</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">analyzers</span><span class="o">.</span><span class="n">TimeReturn</span><span class="p">,</span> <span class="n">_name</span><span class="o">=</span><span class="s1">&#39;alltime_roi&#39;</span><span class="p">,</span>
                        <span class="n">timeframe</span><span class="o">=</span><span class="n">bt</span><span class="o">.</span><span class="n">TimeFrame</span><span class="o">.</span><span class="n">NoTimeFrame</span><span class="p">)</span>

    <span class="n">cerebro</span><span class="o">.</span><span class="n">addanalyzer</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">analyzers</span><span class="o">.</span><span class="n">TimeReturn</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data0</span><span class="p">,</span> <span class="n">_name</span><span class="o">=</span><span class="s1">&#39;benchmark&#39;</span><span class="p">,</span>
                        <span class="n">timeframe</span><span class="o">=</span><span class="n">bt</span><span class="o">.</span><span class="n">TimeFrame</span><span class="o">.</span><span class="n">NoTimeFrame</span><span class="p">)</span>

    <span class="c1"># Add TimeReturn Analyzers fot the annuyl returns</span>
    <span class="n">cerebro</span><span class="o">.</span><span class="n">addanalyzer</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">analyzers</span><span class="o">.</span><span class="n">TimeReturn</span><span class="p">,</span> <span class="n">timeframe</span><span class="o">=</span><span class="n">bt</span><span class="o">.</span><span class="n">TimeFrame</span><span class="o">.</span><span class="n">Years</span><span class="p">)</span>
    <span class="c1"># Add a SharpeRatio</span>
    <span class="n">cerebro</span><span class="o">.</span><span class="n">addanalyzer</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">analyzers</span><span class="o">.</span><span class="n">SharpeRatio</span><span class="p">,</span> <span class="n">timeframe</span><span class="o">=</span><span class="n">bt</span><span class="o">.</span><span class="n">TimeFrame</span><span class="o">.</span><span class="n">Years</span><span class="p">,</span>
                        <span class="n">riskfreerate</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">riskfreerate</span><span class="p">)</span>

    <span class="c1"># Add SQN to qualify the trades</span>
    <span class="n">cerebro</span><span class="o">.</span><span class="n">addanalyzer</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">analyzers</span><span class="o">.</span><span class="n">SQN</span><span class="p">)</span>
    <span class="n">cerebro</span><span class="o">.</span><span class="n">addobserver</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">observers</span><span class="o">.</span><span class="n">DrawDown</span><span class="p">)</span>  <span class="c1"># visualize the drawdown evol</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">cerebro</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">st0</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">alyzer</span> <span class="ow">in</span> <span class="n">st0</span><span class="o">.</span><span class="n">analyzers</span><span class="p">:</span>
        <span class="n">alyzer</span><span class="o">.</span><span class="k">print</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">plot</span><span class="p">:</span>
        <span class="n">pkwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">plot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">True</span><span class="p">:</span>  <span class="c1"># evals to True but is not True</span>
            <span class="n">npkwargs</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;dict(&#39;</span> <span class="o">+</span> <span class="n">args</span><span class="o">.</span><span class="n">plot</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>  <span class="c1"># args were passed</span>
            <span class="n">pkwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">npkwargs</span><span class="p">)</span>

        <span class="n">cerebro</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">**</span><span class="n">pkwargs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">parse_args</span><span class="p">(</span><span class="n">pargs</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentDefaultsHelpFormatter</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Sample for Tharp example with MACD&#39;</span><span class="p">)</span>

    <span class="n">group1</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_mutually_exclusive_group</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">group1</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--data&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Specific data to be read in&#39;</span><span class="p">)</span>

    <span class="n">group1</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--dataset&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">DATASETS</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Choose one of the predefined data sets&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--fromdate&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="s1">&#39;2005-01-01&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Starting date in YYYY-MM-DD format&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--todate&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Ending date in YYYY-MM-DD format&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--cash&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Cash to start with&#39;</span><span class="p">))</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--cashalloc&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.20</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Perc (abs) of cash to allocate for ops&#39;</span><span class="p">))</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--commperc&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.0033</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Perc (abs) commision in each operation. &#39;</span>
                              <span class="s1">&#39;0.001 -&gt; 0.1</span><span class="si">%%</span><span class="s1">, 0.01 -&gt; 1</span><span class="si">%%</span><span class="s1">&#39;</span><span class="p">))</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--macd1&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;MACD Period 1 value&#39;</span><span class="p">))</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--macd2&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">26</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;MACD Period 2 value&#39;</span><span class="p">))</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--macdsig&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;MACD Signal Period value&#39;</span><span class="p">))</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--atrperiod&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;ATR Period To Consider&#39;</span><span class="p">))</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--atrdist&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;ATR Factor for stop price calculation&#39;</span><span class="p">))</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--smaperiod&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Period for the moving average&#39;</span><span class="p">))</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--dirperiod&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Period for SMA direction calculation&#39;</span><span class="p">))</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--riskfreerate&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Risk free rate in Perc (abs) of the asset for &#39;</span>
                              <span class="s1">&#39;the Sharpe Ratio&#39;</span><span class="p">))</span>
    <span class="c1"># Plot options</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--plot&#39;</span><span class="p">,</span> <span class="s1">&#39;-p&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                        <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;kwargs&#39;</span><span class="p">,</span> <span class="n">const</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Plot the read data applying any kwargs passed</span><span class="se">\n</span><span class="s1">&#39;</span>
                              <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                              <span class="s1">&#39;For example:</span><span class="se">\n</span><span class="s1">&#39;</span>
                              <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                              <span class="s1">&#39;  --plot style=&quot;candle&quot; (to plot candles)</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">pargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">pargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">runstrat</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>

  <div class="section">
  
    


<div class="section">
  <span style="float: left;">
  
  
  <a href="../../2016-07-29-pinkfish-challenge/pinkfish-challenge/">
    <i class="fa fa-arrow-circle-left"></i>
    Pinkfish Challenge
  </a>
  
  </span>
  <span>&nbsp;</span>
  <span style="float: right;">
  
  
  <a href="../../2016-08-01-signal-strategy/signal-strategy/">
    Strategy with Signals
    <i class="fa fa-arrow-circle-right"></i>
  </a>
  </span>
  
</div>

  
  
    <div class="section">
    <h2>Comments</h2>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'backtrader'; // required: replace example with your forum shortname
        var disqus_identifier = '/posts/2016-07-30-macd-settings/macd-settings/';
        var disqus_title = 'MACD Settings';
        var disqus_url = 'http://blog.backtrader.com/posts/2016-07-30-macd-settings/macd-settings';
        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  
  </div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../">backtrader</a></h1>





<p>
<iframe src="https://ghbtns.com/github-btn.html?user=mementum&repo=backtrader&type=watch&count=true&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>




    

<p>
<a href="https://travis-ci.org/mementum/backtrader">
    <img
        alt="https://secure.travis-ci.org/mementum/backtrader.png?branch=master"
        src="https://secure.travis-ci.org/mementum/backtrader.png?branch=master"
    />
</a>
</p>



  
  
  <h2>
  
  <i class="fa fa-calendar"></i>
    Jul 30, 2016
  
  </h2>

  <ul>
    

  
  <li><i class="fa-fw fa fa-user"></i>
    
      
      <a href="../../../blog/author/mementum/">mementum</a>
      
    </li>
  

  

  

  

  
  
  <li>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'backtrader'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
    <i class="fa-fw fa fa-comments"></i>
    <a href="#disqus_thread" data-disqus-identifier="/posts/2016-07-30-macd-settings/macd-settings/"> </a>
  </li>
  
  </ul>


<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../about/">About backtrader</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about/#documentation">Documentation</a></li>
</ul>


  <h3><a href="../../../blog/">Recent Posts</a></h3>
  <ul>
    
    
      <li><a href="../../2016-09-17-notebook-inline/notebook-inline/">Sep 17 - Notebook - Automatic Inline Plotting</a></li>
    
      <li><a href="../../2016-09-17-data-synchronization/data-synchronization/">Sep 17 - Data Synchronization Rework</a></li>
    
      <li><a href="../../2016-09-06-vwr/vwr/">Sep 06 - Variability Weighted Return (or VWR)</a></li>
    
      <li><a href="../../2016-09-05-optimization-improvements/optimization-improvements/">Sep 05 - Optimization improvements</a></li>
    
      <li><a href="../../2016-09-02-target-orders/target-orders/">Sep 02 - Target Orders</a></li>
    
  </ul>

  <h3><a href="../../../blog/archive/">Archives</a></h3>
  <ul>
  
    
    <li><a href="../../../blog/2016/">2016 (28)</a></li>
    
  
    
    <li><a href="../../../blog/2015/">2015 (27)</a></li>
    
  
  </ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, mementum.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.7</a>
      
      |
      <a href="../../../_sources/posts/2016-07-30-macd-settings/macd-settings.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/mementum/backtrader" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-2435868-6']);
      _gaq.push(['_setDomainName', 'none']);
      _gaq.push(['_setAllowLinker', true]);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
    
  </body>
</html>