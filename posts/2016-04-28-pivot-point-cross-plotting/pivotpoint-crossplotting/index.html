<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Pivot Point and Cross Plotting &mdash; backtrader  documentation</title>
    
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/sphinxcontrib-images\LightBox2\lightbox2\css\lightbox.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/sphinxcontrib-images\LightBox2\lightbox2\js\jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../_static/sphinxcontrib-images\LightBox2\lightbox2\js\lightbox.min.js"></script>
    <script type="text/javascript" src="../../../_static/sphinxcontrib-images\LightBox2\lightbox2-customize\jquery-noconflict.js"></script>
    <link rel="author" title="About these documents" href="../../../about/" />
    <link rel="top" title="backtrader  documentation" href="../../../" />
  
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  
  
  <link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet">
  
  <style type="text/css">
    ul.ablog-archive {list-style: none; overflow: auto; margin-left: 0px}
    ul.ablog-archive li {float: left; margin-right: 5px; font-size: 80%}
    ul.post-list-style-disc {list-style-type: disc;}
    ul.post-list-style-none {list-style-type: none;}
    ul.post-list-style-circle {list-style-type: circle;}
  </style>

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="pivot-point-and-cross-plotting">
<h1>Pivot Point and Cross Plotting<a class="headerlink" href="#pivot-point-and-cross-plotting" title="Permalink to this headline">¶</a></h1>
<p>An interesting request came across:</p>
<blockquote>
<div><ul class="simple">
<li>PivotPoint</li>
</ul>
</div></blockquote>
<p>It is interesting because of how the indicator is defined. Literature can be
found at <a class="reference external" href="http://stockcharts.com/school/doku.php?id=chart_school:technical_indicators:pivot_points">PivotPoint at StockCharts</a>.
PivotPoints use the <code class="docutils literal"><span class="pre">close</span></code>, <code class="docutils literal"><span class="pre">high</span></code> and <code class="docutils literal"><span class="pre">low</span></code> prices of a past
timeframe. For example for the daily timeframe:</p>
<blockquote>
<div><ul class="simple">
<li><em>Pivot Points for daily charts use the prior month&#8217;s data</em></li>
</ul>
</div></blockquote>
<p>This may seem troublesome because for each timeframe there needs to be a
definition of what other timeframe has to be used. Looking at the formulas
opens up another question:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Pivot Point (P) = (High + Low + Close)/3
Support 1 (S1) = (P x 2) - High
Support 2 (S2) = P  -  (High  -  Low)
Resistance 1 (R1) = (P x 2) - Low
Resistance 2 (R2) = P + (High  -  Low)
</pre></div>
</div>
<p>Even if the text is full of references to <em>prior period</em> and <em>past ...</em> the
formulas seem to reference the current point in time. Let&#8217;s follow the advice
of the <em>text</em> and use <em>previous</em> in our first attempt at the PivotPoint. But
first let&#8217;s tackle the problem of the different timeframes by doing this:</p>
<blockquote>
<div><ul class="simple">
<li>The indicator will not tackle the problem</li>
</ul>
</div></blockquote>
<p>Although this may seem confusing, one has to take into account that
<em>indicators</em> have to remain as stupid as possible and be made up of actual
formulas. The problem will be solved as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">btfeeds</span><span class="o">.</span><span class="n">ADataFeed</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">timeframe</span><span class="o">=</span><span class="n">bt</span><span class="o">.</span><span class="n">TimeFrame</span><span class="o">.</span><span class="n">Days</span><span class="p">)</span>
<span class="n">cerebro</span><span class="o">.</span><span class="n">adddata</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">cerebro</span><span class="o">.</span><span class="n">resampledata</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">timeframe</span><span class="o">=</span><span class="n">bt</span><span class="o">.</span><span class="n">TimeFrame</span><span class="o">.</span><span class="n">Months</span><span class="p">)</span>
</pre></div>
</div>
<p>And later in the <em>Strategy</em>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyStrategy</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pp</span> <span class="o">=</span> <span class="n">PivotPoint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data1</span><span class="p">)</span>  <span class="c1"># the resampled data</span>
</pre></div>
</div>
<p>Now it&#8217;s clear. The system will have the data, plus an extra input resampled to
the needed timeframe. And the <code class="docutils literal"><span class="pre">PivotPoint</span></code> indicator will work with the
resampled data, which is already in the needed <em>monthly</em> timeframe for the
original data timeframe which is <em>daily</em>.</p>
<p>The indicator can be developed. Let&#8217;s start by following the text indications
and not the formulas and look back 1 period.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PivotPoint1</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">Indicator</span><span class="p">):</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;s1&#39;</span><span class="p">,</span> <span class="s1">&#39;s2&#39;</span><span class="p">,</span> <span class="s1">&#39;r1&#39;</span><span class="p">,</span> <span class="s1">&#39;r2&#39;</span><span class="p">,)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">high</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># previous high</span>
        <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">low</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># previous low</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># previous close</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span> <span class="o">+</span> <span class="n">l</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.0</span>

        <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="mf">2.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">s1</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">h</span>  <span class="c1"># (p x 2) - high</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">r1</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">l</span>  <span class="c1"># (p x 2) - low</span>

        <span class="n">hilo</span> <span class="o">=</span> <span class="n">h</span> <span class="o">-</span> <span class="n">l</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">s2</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="n">hilo</span>  <span class="c1"># p - (high - low)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">r2</span> <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="n">hilo</span>  <span class="c1"># p + (high - low)</span>

</pre></div>
</div>
<p>The strategy will look at parameter <code class="docutils literal"><span class="pre">usepp1</span></code> to use this <code class="docutils literal"><span class="pre">PivotPoint1</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">usepp1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pp</span> <span class="o">=</span> <span class="n">PivotPoint1</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pp</span> <span class="o">=</span> <span class="n">PivotPoint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data1</span><span class="p">)</span>

</pre></div>
</div>
<p>And the output is controlled by a simple <code class="docutils literal"><span class="pre">next</span></code> method</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;</span><span class="si">%04d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
             <span class="s1">&#39;</span><span class="si">%04d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data0</span><span class="p">),</span>
             <span class="s1">&#39;</span><span class="si">%04d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data1</span><span class="p">),</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
             <span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

        <span class="k">print</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>

</pre></div>
</div>
<p>Let&#8217;s execute:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>./ppsample --usepp1
</pre></div>
</div>
<p>And the output:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="mo">0041</span><span class="p">,</span><span class="mo">0041</span><span class="p">,</span><span class="mo">0002</span><span class="p">,</span><span class="mi">2005</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">28</span><span class="p">,</span><span class="mf">2962.79</span>
<span class="mo">0042</span><span class="p">,</span><span class="mo">0042</span><span class="p">,</span><span class="mo">0002</span><span class="p">,</span><span class="mi">2005</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mo">01</span><span class="p">,</span><span class="mf">2962.79</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Immediately something is clear: <em>index 41 already belongs to the 2nd
month</em>. That means we have skipped calculation of the indicator by 1 month. It
is now clear why the text in <em>StockCharts</em> is always mentioning that the
calculation happens with the previous <em>month</em> but the formulas seem to
reference the current moment.</p>
<blockquote>
<div><ul>
<li><p class="first">The developers probably faced the same design decisions with multiple datas
with multiple timeframes.</p>
<p>At the current <em>daily</em> point, only the <em>closed</em> bar from the previous
<em>month</em> can be delivered.</p>
</li>
</ul>
</div></blockquote>
<p>That&#8217;s why the <code class="docutils literal"><span class="pre">next</span></code> method is looking at index <code class="docutils literal"><span class="pre">[0]</span></code>. All this has a very
easy fix and that&#8217;s writing the formulas just like <em>StockCharts</em> documents them.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PivotPoint</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">Indicator</span><span class="p">):</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;s1&#39;</span><span class="p">,</span> <span class="s1">&#39;s2&#39;</span><span class="p">,</span> <span class="s1">&#39;r1&#39;</span><span class="p">,</span> <span class="s1">&#39;r2&#39;</span><span class="p">,)</span>
    <span class="n">plotinfo</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">subplot</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">high</span>  <span class="c1"># current high</span>
        <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">low</span>  <span class="c1"># current high</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">close</span>  <span class="c1"># current high</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span> <span class="o">+</span> <span class="n">l</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.0</span>

        <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="mf">2.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">s1</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">h</span>  <span class="c1"># (p x 2) - high</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">r1</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">l</span>  <span class="c1"># (p x 2) - low</span>

        <span class="n">hilo</span> <span class="o">=</span> <span class="n">h</span> <span class="o">-</span> <span class="n">l</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">s2</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="n">hilo</span>  <span class="c1"># p - (high - low)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">r2</span> <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="n">hilo</span>  <span class="c1"># p + (high - low)</span>
</pre></div>
</div>
<p>An execution without <code class="docutils literal"><span class="pre">usepp1</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>./ppsample
</pre></div>
</div>
<p>And the new output is:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="mo">0021</span><span class="p">,</span><span class="mo">0021</span><span class="p">,</span><span class="mo">0001</span><span class="p">,</span><span class="mi">2005</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mi">31</span><span class="p">,</span><span class="mf">2962.79</span>
<span class="mo">0022</span><span class="p">,</span><span class="mo">0022</span><span class="p">,</span><span class="mo">0001</span><span class="p">,</span><span class="mi">2005</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mo">01</span><span class="p">,</span><span class="mf">2962.79</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Et voilá! The 1st month had <code class="docutils literal"><span class="pre">20</span></code> trading days and once complete the indicator
has calculated the values and can be delivered. The only printed line is <code class="docutils literal"><span class="pre">p</span></code>
and if the value is the same in the 2 lines is because the value remains fixed
for the entire next month. Quoting <em>StockCharts</em>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Once Pivot Points are set, they do not change and remain in play throughout ...
</pre></div>
</div>
<p>The indicator can already be used. Let&#8217;s go for plotting. A plotting parameter
has already been set</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="n">plotinfo</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">subplot</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

</pre></div>
</div>
<p>The calculated values are in line with the data scale and just like a <em>Moving
Average</em> it can be plotted along the data (hence <code class="docutils literal"><span class="pre">subplot=False</span></code>)</p>
<p>An execution with <code class="docutils literal"><span class="pre">--plot</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>./ppsample --plot
</pre></div>
</div>
<a class=""
               data-lightbox="group-c40b9320-97af-4775-8cff-32ba1e5d1a2b"
               href="../../../_images/pivotpoint-on-monthly-data1.png"
               title=""
               data-title=""
               ><img src="../../../_images/pivotpoint-on-monthly-data1.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a><p>The blistering barnacles are attacking again. The indicator has been plotted on
the monthly data (its source), which gives no visual indication on the daily
chart, where it would be really helpful.</p>
<p>But <code class="docutils literal"><span class="pre">backtrader</span></code> supports cross-plotting from one data to another. Although
a small addition in <code class="docutils literal"><span class="pre">1.2.8.88</span></code> was needed to support cross-plotting to a data
of a different timeframe.</p>
<p>This is achieved by having <code class="docutils literal"><span class="pre">plotmaster</span></code> say which the plot target is, by
adding it to the <code class="docutils literal"><span class="pre">plotinfo</span></code> attribute of the indicator:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>./ppsample --plot --plot-on-daily
</pre></div>
</div>
<a class=""
               data-lightbox="group-415a21aa-a447-41f9-9c28-5554b39f382d"
               href="../../../_images/pivotpoint-on-daily-data1.png"
               title=""
               data-title=""
               ><img src="../../../_images/pivotpoint-on-daily-data1.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a><p>The visual feedback is now useful to understand what <code class="docutils literal"><span class="pre">PivotPoint</span></code> is offering.</p>
<div class="section" id="script-code-and-usage">
<h2>Script Code and Usage<a class="headerlink" href="#script-code-and-usage" title="Permalink to this headline">¶</a></h2>
<p>Available as sample in the sources of <code class="docutils literal"><span class="pre">backtrader</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./ppsample.py --help
usage: ppsample.py [-h] [--data DATA] [--usepp1] [--plot] [--plot-on-daily]

Sample for pivot point and cross plotting

optional arguments:
  -h, --help       show this help message and exit
  --data DATA      Data to be read in (default:
                   ../../datas/2005-2006-day-001.txt)
  --usepp1         Have PivotPoint look 1 period backwards (default: False)
  --plot           Plot the result (default: False)
  --plot-on-daily  Plot the indicator on the daily data (default: False)
</pre></div>
</div>
<p>The code for <code class="docutils literal"><span class="pre">PivotPoint</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="p">(</span><span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,)</span>
<span class="c1">#                        unicode_literals)</span>

<span class="kn">import</span> <span class="nn">backtrader</span> <span class="kn">as</span> <span class="nn">bt</span>


<span class="k">class</span> <span class="nc">PivotPoint1</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">Indicator</span><span class="p">):</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;s1&#39;</span><span class="p">,</span> <span class="s1">&#39;s2&#39;</span><span class="p">,</span> <span class="s1">&#39;r1&#39;</span><span class="p">,</span> <span class="s1">&#39;r2&#39;</span><span class="p">,)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">high</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># previous high</span>
        <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">low</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># previous low</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># previous close</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span> <span class="o">+</span> <span class="n">l</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.0</span>

        <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="mf">2.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">s1</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">h</span>  <span class="c1"># (p x 2) - high</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">r1</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">l</span>  <span class="c1"># (p x 2) - low</span>

        <span class="n">hilo</span> <span class="o">=</span> <span class="n">h</span> <span class="o">-</span> <span class="n">l</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">s2</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="n">hilo</span>  <span class="c1"># p - (high - low)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">r2</span> <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="n">hilo</span>  <span class="c1"># p + (high - low)</span>


<span class="k">class</span> <span class="nc">PivotPoint</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">Indicator</span><span class="p">):</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;s1&#39;</span><span class="p">,</span> <span class="s1">&#39;s2&#39;</span><span class="p">,</span> <span class="s1">&#39;r1&#39;</span><span class="p">,</span> <span class="s1">&#39;r2&#39;</span><span class="p">,)</span>
    <span class="n">plotinfo</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">subplot</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">high</span>  <span class="c1"># current high</span>
        <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">low</span>  <span class="c1"># current high</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">close</span>  <span class="c1"># current high</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span> <span class="o">+</span> <span class="n">l</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.0</span>

        <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="mf">2.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">s1</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">h</span>  <span class="c1"># (p x 2) - high</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">r1</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">l</span>  <span class="c1"># (p x 2) - low</span>

        <span class="n">hilo</span> <span class="o">=</span> <span class="n">h</span> <span class="o">-</span> <span class="n">l</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">s2</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="n">hilo</span>  <span class="c1"># p - (high - low)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">r2</span> <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="n">hilo</span>  <span class="c1"># p + (high - low)</span>
</pre></div>
</div>
<p>The code for the script.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="p">(</span><span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span>
                        <span class="n">unicode_literals</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">argparse</span>

<span class="kn">import</span> <span class="nn">backtrader</span> <span class="kn">as</span> <span class="nn">bt</span>
<span class="kn">import</span> <span class="nn">backtrader.feeds</span> <span class="kn">as</span> <span class="nn">btfeeds</span>
<span class="kn">import</span> <span class="nn">backtrader.utils.flushfile</span>

<span class="kn">from</span> <span class="nn">pivotpoint</span> <span class="kn">import</span> <span class="n">PivotPoint</span><span class="p">,</span> <span class="n">PivotPoint1</span>


<span class="k">class</span> <span class="nc">St</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">((</span><span class="s1">&#39;usepp1&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
              <span class="p">(</span><span class="s1">&#39;plot_on_daily&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">usepp1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pp</span> <span class="o">=</span> <span class="n">PivotPoint1</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pp</span> <span class="o">=</span> <span class="n">PivotPoint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data1</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">plot_on_daily</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">plotinfo</span><span class="o">.</span><span class="n">plotmaster</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data0</span>

    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;</span><span class="si">%04d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
             <span class="s1">&#39;</span><span class="si">%04d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data0</span><span class="p">),</span>
             <span class="s1">&#39;</span><span class="si">%04d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data1</span><span class="p">),</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
             <span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

        <span class="k">print</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">runstrat</span><span class="p">():</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parse_args</span><span class="p">()</span>

    <span class="n">cerebro</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Cerebro</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">btfeeds</span><span class="o">.</span><span class="n">BacktraderCSVData</span><span class="p">(</span><span class="n">dataname</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">cerebro</span><span class="o">.</span><span class="n">adddata</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">cerebro</span><span class="o">.</span><span class="n">resampledata</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">timeframe</span><span class="o">=</span><span class="n">bt</span><span class="o">.</span><span class="n">TimeFrame</span><span class="o">.</span><span class="n">Months</span><span class="p">)</span>

    <span class="n">cerebro</span><span class="o">.</span><span class="n">addstrategy</span><span class="p">(</span><span class="n">St</span><span class="p">,</span>
                        <span class="n">usepp1</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">usepp1</span><span class="p">,</span>
                        <span class="n">plot_on_daily</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">plot_on_daily</span><span class="p">)</span>
    <span class="n">cerebro</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">plot</span><span class="p">:</span>
        <span class="n">cerebro</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">parse_args</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentDefaultsHelpFormatter</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Sample for pivot point and cross plotting&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--data&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="s1">&#39;../../datas/2005-2006-day-001.txt&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Data to be read in&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--usepp1&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Have PivotPoint look 1 period backwards&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--plot&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Plot the result&#39;</span><span class="p">))</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--plot-on-daily&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Plot the indicator on the daily data&#39;</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">runstrat</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>

  <div class="section">
  
    


<div class="section">
  <span style="float: left;">
  
  
  <a href="../../2016-04-19-sync-different-markets/sync-different-markets/">
    <i class="fa fa-arrow-circle-left"></i>
    Synchronizing different markets
  </a>
  
  </span>
  <span>&nbsp;</span>
  <span style="float: right;">
  
  
  <a href="../../2016-05-05-indicators-mixing-timeframes/indicators-mixing-timeframes/">
    Mixing Timeframes in Indicators
    <i class="fa fa-arrow-circle-right"></i>
  </a>
  </span>
  
</div>

  
  
    <div class="section">
    <h2>Comments</h2>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'backtrader'; // required: replace example with your forum shortname
        var disqus_identifier = '/posts/2016-04-28-pivot-point-cross-plotting/pivotpoint-crossplotting/';
        var disqus_title = 'Pivot Point and Cross Plotting';
        var disqus_url = 'http://blog.backtrader.com/posts/2016-04-28-pivot-point-cross-plotting/pivotpoint-crossplotting';
        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  
  </div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../">backtrader</a></h1>





<p>
<iframe src="https://ghbtns.com/github-btn.html?user=mementum&repo=backtrader&type=watch&count=true&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>




    

<p>
<a href="https://travis-ci.org/mementum/backtrader">
    <img
        alt="https://secure.travis-ci.org/mementum/backtrader.png?branch=master"
        src="https://secure.travis-ci.org/mementum/backtrader.png?branch=master"
    />
</a>
</p>



  
  
  <h2>
  
  <i class="fa fa-calendar"></i>
    Apr 28, 2016
  
  </h2>

  <ul>
    

  
  <li><i class="fa-fw fa fa-user"></i>
    
      
      <a href="../../../blog/author/mementum/">mementum</a>
      
    </li>
  

  

  

  

  
  
  <li>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'backtrader'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
    <i class="fa-fw fa fa-comments"></i>
    <a href="#disqus_thread" data-disqus-identifier="/posts/2016-04-28-pivot-point-cross-plotting/pivotpoint-crossplotting/"> </a>
  </li>
  
  </ul>


<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../about/">About backtrader</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about/#documentation">Documentation</a></li>
</ul>


  <h3><a href="../../../blog/">Recent Posts</a></h3>
  <ul>
    
    
      <li><a href="../../2016-09-17-notebook-inline/notebook-inline/">Sep 17 - Notebook - Automatic Inline Plotting</a></li>
    
      <li><a href="../../2016-09-17-data-synchronization/data-synchronization/">Sep 17 - Data Synchronization Rework</a></li>
    
      <li><a href="../../2016-09-06-vwr/vwr/">Sep 06 - Variability Weighted Return (or VWR)</a></li>
    
      <li><a href="../../2016-09-05-optimization-improvements/optimization-improvements/">Sep 05 - Optimization improvements</a></li>
    
      <li><a href="../../2016-09-02-target-orders/target-orders/">Sep 02 - Target Orders</a></li>
    
  </ul>

  <h3><a href="../../../blog/archive/">Archives</a></h3>
  <ul>
  
    
    <li><a href="../../../blog/2016/">2016 (28)</a></li>
    
  
    
    <li><a href="../../../blog/2015/">2015 (27)</a></li>
    
  
  </ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, mementum.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.7</a>
      
      |
      <a href="../../../_sources/posts/2016-04-28-pivot-point-cross-plotting/pivotpoint-crossplotting.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/mementum/backtrader" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-2435868-6']);
      _gaq.push(['_setDomainName', 'none']);
      _gaq.push(['_setAllowLinker', true]);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
    
  </body>
</html>