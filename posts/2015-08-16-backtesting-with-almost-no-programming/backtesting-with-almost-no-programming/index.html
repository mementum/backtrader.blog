<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Automating backtrader BackTesting &mdash; backtrader  documentation</title>
    
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/sphinxcontrib-images\LightBox2\lightbox2\css\lightbox.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/sphinxcontrib-images\LightBox2\lightbox2\js\jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../_static/sphinxcontrib-images\LightBox2\lightbox2\js\lightbox.min.js"></script>
    <script type="text/javascript" src="../../../_static/sphinxcontrib-images\LightBox2\lightbox2-customize\jquery-noconflict.js"></script>
    <link rel="author" title="About these documents" href="../../../about/" />
    <link rel="top" title="backtrader  documentation" href="../../../" />
  
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  
  
  <link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet">
  
  <style type="text/css">
    ul.ablog-archive {list-style: none; overflow: auto; margin-left: 0px}
    ul.ablog-archive li {float: left; margin-right: 5px; font-size: 80%}
    ul.post-list-style-disc {list-style-type: disc;}
    ul.post-list-style-none {list-style-type: none;}
    ul.post-list-style-circle {list-style-type: circle;}
  </style>

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="automating-backtrader-backtesting">
<h1>Automating <code class="docutils literal"><span class="pre">backtrader</span></code> BackTesting<a class="headerlink" href="#automating-backtrader-backtesting" title="Permalink to this headline">¶</a></h1>
<div class="note update admonition">
<p class="first admonition-title">Updated on Aug 22, 2015</p>
<p class="last"><code class="docutils literal"><span class="pre">Analyzer</span></code> support in <code class="docutils literal"><span class="pre">bt-run.py</span></code> included</p>
</div>
<p>So far all <code class="docutils literal"><span class="pre">backtrader</span></code> examples and working samples have started from scratch
creating a main <strong>Python</strong> module which loads datas, strategies, observers and
prepares cash and commission schemes.</p>
<p>One of the goals of <em>algorithmic trading</em> is the automation of trading and given
that bactrader is a <em>backtesting</em> platform intented to check trading algorithms
(hence is an <em>algotrading</em> platform), automating the use of backtrader was an
obvious goal.</p>
<p>The development version of <code class="docutils literal"><span class="pre">backtrader</span></code> now contains the <code class="docutils literal"><span class="pre">bt-run.py</span></code> script
which automates most tasks and will be installed along <code class="docutils literal"><span class="pre">backtrader</span></code> as part of
a regular package.</p>
<p><code class="docutils literal"><span class="pre">bt-run.py</span></code> allows the end user to:</p>
<blockquote>
<div><ul class="simple">
<li>Say which datas have to be loaded</li>
<li>Set the format to load the datas</li>
<li>Specify the date range for the datas</li>
<li>Disable standard observers</li>
<li>Load one or more observers (example: DrawDown) from the built-in ones or
from a python module</li>
<li>Set the cash and commission scheme parameters for the broker (commission,
margin, mult)</li>
<li>Enable plotting, controlling the amount of charts and style to present the
data</li>
</ul>
</div></blockquote>
<p>And finally:</p>
<blockquote>
<div><ul class="simple">
<li>Load a strategy (a built-in one or from a Python module)</li>
<li>Pass parameters to the loaded strategy</li>
</ul>
</div></blockquote>
<p>See below for the <strong>Usage*</strong> of the script.</p>
<div class="section" id="applying-a-user-defined-strategy">
<h2>Applying a User Defined Strategy<a class="headerlink" href="#applying-a-user-defined-strategy" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s consider the following strategy which:</p>
<blockquote>
<div><ul class="simple">
<li>Simply loads a SimpleMovingAverage (default period 15)</li>
<li>Prints outs</li>
<li>Is in a fily with the name mymod.py</li>
</ul>
</div></blockquote>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="p">(</span><span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span>
                        <span class="n">unicode_literals</span><span class="p">)</span>


<span class="kn">import</span> <span class="nn">backtrader</span> <span class="kn">as</span> <span class="nn">bt</span>
<span class="kn">import</span> <span class="nn">backtrader.indicators</span> <span class="kn">as</span> <span class="nn">btind</span>


<span class="k">class</span> <span class="nc">MyTest</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">((</span><span class="s1">&#39;period&#39;</span><span class="p">,</span> <span class="mi">15</span><span class="p">),)</span>

    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">txt</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Logging function fot this strategy&#39;&#39;&#39;</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">dt</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">datetime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span> <span class="n">txt</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sma</span> <span class="o">=</span> <span class="n">btind</span><span class="o">.</span><span class="n">SMA</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">period</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ltxt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">, </span><span class="si">%.2f</span><span class="s1">, </span><span class="si">%.2f</span><span class="s1">, </span><span class="si">%.2f</span><span class="s1">, </span><span class="si">%.2f</span><span class="s1">, </span><span class="si">%.2f</span><span class="s1">, </span><span class="si">%.2f</span><span class="s1">&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">ltxt</span> <span class="o">%</span>
                 <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">open</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">high</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">low</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">close</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">volume</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">openinterest</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
<p>Executing the strategy with the usual testing sample is easy:
easy:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>./bt-run.py --csvformat btcsv \
            --data ../samples/data/sample/2006-day-001.txt \
            --strategy ./mymod.py
</pre></div>
</div>
<p>The chart output</p>
<a class=""
               data-lightbox="group-17243122-4553-4baf-927e-83b40269eab8"
               href="../../../_images/bt-run-mymod-no-params1.png"
               title=""
               data-title=""
               ><img src="../../../_images/bt-run-mymod-no-params1.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a><p>The console output:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>2006-01-20T23:59:59+00:00, 15, 3593.16, 3612.37, 3550.80, 3550.80, 0.00, 0.00
2006-01-23T23:59:59+00:00, 16, 3550.24, 3550.24, 3515.07, 3544.31, 0.00, 0.00
2006-01-24T23:59:59+00:00, 17, 3544.78, 3553.16, 3526.37, 3532.68, 0.00, 0.00
2006-01-25T23:59:59+00:00, 18, 3532.72, 3578.00, 3532.72, 3578.00, 0.00, 0.00
...
...
2006-12-22T23:59:59+00:00, 252, 4109.86, 4109.86, 4072.62, 4073.50, 0.00, 0.00
2006-12-27T23:59:59+00:00, 253, 4079.70, 4134.86, 4079.70, 4134.86, 0.00, 0.00
2006-12-28T23:59:59+00:00, 254, 4137.44, 4142.06, 4125.14, 4130.66, 0.00, 0.00
2006-12-29T23:59:59+00:00, 255, 4130.12, 4142.01, 4119.94, 4119.94, 0.00, 0.00
</pre></div>
</div>
<p>Same strategy but:</p>
<blockquote>
<div><ul class="simple">
<li>Setting the parameter <code class="docutils literal"><span class="pre">period</span></code> to 50</li>
</ul>
</div></blockquote>
<p>The command line:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>./bt-run.py --csvformat btcsv \
            --data ../samples/data/sample/2006-day-001.txt \
            --strategy ./mymod.py \
            period 50
</pre></div>
</div>
<p>The chart output.</p>
<a class=""
               data-lightbox="group-3e66a060-1e6a-4a8f-bfe1-891df225ec6b"
               href="../../../_images/bt-run-mymod-period-501.png"
               title=""
               data-title=""
               ><img src="../../../_images/bt-run-mymod-period-501.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a></div>
<div class="section" id="using-a-built-in-strategy">
<h2>Using a built-in Strategy<a class="headerlink" href="#using-a-built-in-strategy" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">backtrader</span></code> will slowly be including sample (textbook) strategies. Along with
the <code class="docutils literal"><span class="pre">bt-run.py</span></code> script a standard <em>Simple Moving Average CrossOver</em> strategy
is included. The name:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">SMA_CrossOver</span></code></li>
<li>Parameters<ul>
<li>fast (default 10) period of the fast moving average</li>
<li>slow (default 30) period of the slow moving average</li>
</ul>
</li>
</ul>
</div></blockquote>
<p>The strategy buys if the fast moving average crosses up the fast and sells (only
if it has bought before) upon the fast moving average crossing down the slow
moving average.</p>
<p>The code</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="p">(</span><span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span>
                        <span class="n">unicode_literals</span><span class="p">)</span>


<span class="kn">import</span> <span class="nn">backtrader</span> <span class="kn">as</span> <span class="nn">bt</span>
<span class="kn">import</span> <span class="nn">backtrader.indicators</span> <span class="kn">as</span> <span class="nn">btind</span>


<span class="k">class</span> <span class="nc">SMA_CrossOver</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">):</span>

    <span class="n">params</span> <span class="o">=</span> <span class="p">((</span><span class="s1">&#39;fast&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;slow&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">sma_fast</span> <span class="o">=</span> <span class="n">btind</span><span class="o">.</span><span class="n">SMA</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">fast</span><span class="p">)</span>
        <span class="n">sma_slow</span> <span class="o">=</span> <span class="n">btind</span><span class="o">.</span><span class="n">SMA</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">slow</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">buysig</span> <span class="o">=</span> <span class="n">btind</span><span class="o">.</span><span class="n">CrossOver</span><span class="p">(</span><span class="n">sma_fast</span><span class="p">,</span> <span class="n">sma_slow</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">buysig</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sell</span><span class="p">()</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">buysig</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buy</span><span class="p">()</span>
</pre></div>
</div>
<p>Standard execution:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>./bt-run.py --csvformat btcsv \
            --data ../samples/data/sample/2006-day-001.txt \
            --strategy :SMA_CrossOver
</pre></div>
</div>
<p>Notice the &#8216;:&#8217;. The standard notation (see below) to load a strategy is:</p>
<blockquote>
<div><ul class="simple">
<li>module:stragegy</li>
</ul>
</div></blockquote>
<p>With the following rules:</p>
<blockquote>
<div><ul class="simple">
<li>If module is there and strategy is specified, then that strategy will be
used</li>
<li>If module is there but no strategy is specified, the 1st strategy found in
the module will be returned</li>
<li>If no module is specified, &#8220;strategy&#8221; is assumed to refer to a strategy in
the <code class="docutils literal"><span class="pre">backtrader</span></code> package</li>
</ul>
</div></blockquote>
<p>The latter being our case.</p>
<p>The output.</p>
<a class=""
               data-lightbox="group-9dcdff00-2570-4f9c-b32f-b9aac953369e"
               href="../../../_images/bt-run-sma-crossover1.png"
               title=""
               data-title=""
               ><img src="../../../_images/bt-run-sma-crossover1.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a><p>One last example adding commission schemes, cash and changing the parameters:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>./bt-run.py --csvformat btcsv \
            --data ../samples/data/sample/2006-day-001.txt \
            --cash 20000 \
            --commission 2.0 \
            --mult 10 \
            --margin 2000 \
            --strategy :SMA_CrossOver \
            fast 5 slow 20
</pre></div>
</div>
<p>The output.</p>
<a class=""
               data-lightbox="group-40fcefa0-8bf9-4a72-a9d7-6461307864c6"
               href="../../../_images/bt-run-sma-crossover-params-commission1.png"
               title=""
               data-title=""
               ><img src="../../../_images/bt-run-sma-crossover-params-commission1.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a><p>We have backtested the strategy:</p>
<blockquote>
<div><ul>
<li><p class="first">Changing the moving average periods</p>
</li>
<li><p class="first">Setting a new starting cash</p>
</li>
<li><p class="first">Putting a commission scheme in place for a futures-like instrument</p>
<p>See the continuous variations in cash with each bar, as cash is adjusted for
the futures-like instrument daily changes</p>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="adding-analyzers">
<h2>Adding Analyzers<a class="headerlink" href="#adding-analyzers" title="Permalink to this headline">¶</a></h2>
<div class="note update admonition">
<p class="first admonition-title">Updated on Aug 22, 2015</p>
<p class="last">Added Analyzer example</p>
</div>
<p><code class="docutils literal"><span class="pre">bt-run.py</span></code> also supports adding <code class="docutils literal"><span class="pre">Analyzers</span></code> with the same syntax used for
the strategies to choose between internal/external analyzers.</p>
<p>Example with a <code class="docutils literal"><span class="pre">SharpeRatio</span></code> analysis for the years 2005-2006:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>./bt-run.py --csvformat btcsv \
            --data ../samples/data/sample/2005-2006-day-001.txt \
            --strategy :SMA_CrossOver \
            --analyzer :SharpeRatio
</pre></div>
</div>
<p>The output:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>====================
== Analyzers
====================
##  sharperatio
--  sharperatio : 11.6473326097
</pre></div>
</div>
<p>Good strategy!!! (Pure luck for the example actually which also bears no
commissions)</p>
<p>The chart (which simply shows the Analyzer is not in the plot, because Analyzers
cannot be plotted, they aren&#8217;t lines objects)</p>
<a class=""
               data-lightbox="group-d5bea8f7-db1e-424d-9b81-469294a68c64"
               href="../../../_images/bt-run-sma-crossover-sharpe1.png"
               title=""
               data-title=""
               ><img src="../../../_images/bt-run-sma-crossover-sharpe1.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a></div>
<div class="section" id="usage-of-the-script">
<h2>Usage of the script<a class="headerlink" href="#usage-of-the-script" title="Permalink to this headline">¶</a></h2>
<p>Directly from the script:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./bt-run.py --help
usage: bt-run.py [-h] --data DATA
                 [--csvformat {yahoocsv_unreversed,vchart,sierracsv,yahoocsv,vchartcsv,btcsv}]
                 [--fromdate FROMDATE] [--todate TODATE] --strategy STRATEGY
                 [--nostdstats] [--observer OBSERVERS] [--analyzer ANALYZERS]
                 [--cash CASH] [--commission COMMISSION] [--margin MARGIN]
                 [--mult MULT] [--noplot] [--plotstyle {bar,line,candle}]
                 [--plotfigs PLOTFIGS]
                 ...

Backtrader Run Script

positional arguments:
  args                  args to pass to the loaded strategy

optional arguments:
  -h, --help            show this help message and exit

Data options:
  --data DATA, -d DATA  Data files to be added to the system
  --csvformat {yahoocsv_unreversed,vchart,sierracsv,yahoocsv,vchartcsv,btcsv}, -c {yahoocsv_unreversed,vchart,sierracsv,yahoocsv,vchartcsv,btcsv}
                        CSV Format
  --fromdate FROMDATE, -f FROMDATE
                        Starting date in YYYY-MM-DD[THH:MM:SS] format
  --todate TODATE, -t TODATE
                        Ending date in YYYY-MM-DD[THH:MM:SS] format

Strategy options:
  --strategy STRATEGY, -st STRATEGY
                        Module and strategy to load with format
                        module_path:strategy_name. module_path:strategy_name
                        will load strategy_name from the given module_path
                        module_path will load the module and return the first
                        available strategy in the module :strategy_name will
                        load the given strategy from the set of built-in
                        strategies

Observers and statistics:
  --nostdstats          Disable the standard statistics observers
  --observer OBSERVERS, -ob OBSERVERS
                        This option can be specified multiple times Module and
                        observer to load with format
                        module_path:observer_name. module_path:observer_name
                        will load observer_name from the given module_path
                        module_path will load the module and return all
                        available observers in the module :observer_name will
                        load the given strategy from the set of built-in
                        strategies

Analyzers:
  --analyzer ANALYZERS, -an ANALYZERS
                        This option can be specified multiple times Module and
                        analyzer to load with format
                        module_path:analzyer_name. module_path:analyzer_name
                        will load observer_name from the given module_path
                        module_path will load the module and return all
                        available analyzers in the module :anaylzer_name will
                        load the given strategy from the set of built-in
                        strategies

Cash and Commission Scheme Args:
  --cash CASH, -cash CASH
                        Cash to set to the broker
  --commission COMMISSION, -comm COMMISSION
                        Commission value to set
  --margin MARGIN, -marg MARGIN
                        Margin type to set
  --mult MULT, -mul MULT
                        Multiplier to use

Plotting options:
  --noplot, -np         Do not plot the read data
  --plotstyle {bar,line,candle}, -ps {bar,line,candle}
                        Plot style for the input data
  --plotfigs PLOTFIGS, -pn PLOTFIGS
                        Plot using n figures
</pre></div>
</div>
<p>And the code:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="p">(</span><span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span>
                        <span class="n">unicode_literals</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">backtrader</span> <span class="kn">as</span> <span class="nn">bt</span>
<span class="kn">import</span> <span class="nn">backtrader.feeds</span> <span class="kn">as</span> <span class="nn">btfeeds</span>
<span class="kn">import</span> <span class="nn">backtrader.indicators</span> <span class="kn">as</span> <span class="nn">btinds</span>
<span class="kn">import</span> <span class="nn">backtrader.observers</span> <span class="kn">as</span> <span class="nn">btobs</span>
<span class="kn">import</span> <span class="nn">backtrader.strategies</span> <span class="kn">as</span> <span class="nn">btstrats</span>
<span class="kn">import</span> <span class="nn">backtrader.analyzers</span> <span class="kn">as</span> <span class="nn">btanalyzers</span>


<span class="n">DATAFORMATS</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">btcsv</span><span class="o">=</span><span class="n">btfeeds</span><span class="o">.</span><span class="n">BacktraderCSVData</span><span class="p">,</span>
    <span class="n">vchartcsv</span><span class="o">=</span><span class="n">btfeeds</span><span class="o">.</span><span class="n">VChartCSVData</span><span class="p">,</span>
    <span class="n">vchart</span><span class="o">=</span><span class="n">btfeeds</span><span class="o">.</span><span class="n">VChartData</span><span class="p">,</span>
    <span class="n">sierracsv</span><span class="o">=</span><span class="n">btfeeds</span><span class="o">.</span><span class="n">SierraChartCSVData</span><span class="p">,</span>
    <span class="n">yahoocsv</span><span class="o">=</span><span class="n">btfeeds</span><span class="o">.</span><span class="n">YahooFinanceCSVData</span><span class="p">,</span>
    <span class="n">yahoocsv_unreversed</span><span class="o">=</span><span class="n">btfeeds</span><span class="o">.</span><span class="n">YahooFinanceCSVData</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">runstrat</span><span class="p">():</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parse_args</span><span class="p">()</span>

    <span class="n">stdstats</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">nostdstats</span>

    <span class="n">cerebro</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Cerebro</span><span class="p">(</span><span class="n">stdstats</span><span class="o">=</span><span class="n">stdstats</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">getdatas</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
        <span class="n">cerebro</span><span class="o">.</span><span class="n">adddata</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># Prepare a dictionary of extra args passed to push them to the strategy</span>

    <span class="c1"># pack them in pairs</span>
    <span class="n">packedargs</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">izip_longest</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">iter</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">args</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># prepare a string for evaluation, eval and store the result</span>
    <span class="n">evalargs</span> <span class="o">=</span> <span class="s1">&#39;dict(&#39;</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">packedargs</span><span class="p">:</span>
        <span class="n">evalargs</span> <span class="o">+=</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="n">value</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>
    <span class="n">evalargs</span> <span class="o">+=</span> <span class="s1">&#39;)&#39;</span>
    <span class="n">stratkwargs</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">evalargs</span><span class="p">)</span>

    <span class="c1"># Get the strategy and add it with any arguments</span>
    <span class="n">strat</span> <span class="o">=</span> <span class="n">getstrategy</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="n">cerebro</span><span class="o">.</span><span class="n">addstrategy</span><span class="p">(</span><span class="n">strat</span><span class="p">,</span> <span class="o">**</span><span class="n">stratkwargs</span><span class="p">)</span>

    <span class="n">obs</span> <span class="o">=</span> <span class="n">getobservers</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ob</span> <span class="ow">in</span> <span class="n">obs</span><span class="p">:</span>
        <span class="n">cerebro</span><span class="o">.</span><span class="n">addobserver</span><span class="p">(</span><span class="n">ob</span><span class="p">)</span>

    <span class="n">ans</span> <span class="o">=</span> <span class="n">getanalyzers</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">an</span> <span class="ow">in</span> <span class="n">ans</span><span class="p">:</span>
        <span class="n">cerebro</span><span class="o">.</span><span class="n">addanalyzer</span><span class="p">(</span><span class="n">an</span><span class="p">)</span>

    <span class="n">setbroker</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">cerebro</span><span class="p">)</span>

    <span class="n">runsts</span> <span class="o">=</span> <span class="n">cerebro</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">runst</span> <span class="o">=</span> <span class="n">runsts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># single strategy and no optimization</span>

    <span class="k">if</span> <span class="n">runst</span><span class="o">.</span><span class="n">analyzers</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;====================&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;== Analyzers&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;====================&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">analyzer</span> <span class="ow">in</span> <span class="n">runst</span><span class="o">.</span><span class="n">analyzers</span><span class="o">.</span><span class="n">getitems</span><span class="p">():</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;## &#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">analysis</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">get_analysis</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;-- &#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">noplot</span><span class="p">:</span>
        <span class="n">cerebro</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">numfigs</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">plotfigs</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">plotstyle</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">setbroker</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">cerebro</span><span class="p">):</span>
    <span class="n">broker</span> <span class="o">=</span> <span class="n">cerebro</span><span class="o">.</span><span class="n">getbroker</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">cash</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">broker</span><span class="o">.</span><span class="n">setcash</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">cash</span><span class="p">)</span>

    <span class="n">commkwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">commission</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">commkwargs</span><span class="p">[</span><span class="s1">&#39;commission&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">commission</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">margin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">commkwargs</span><span class="p">[</span><span class="s1">&#39;margin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">margin</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">mult</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">commkwargs</span><span class="p">[</span><span class="s1">&#39;mult&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">mult</span>

    <span class="k">if</span> <span class="n">commkwargs</span><span class="p">:</span>
        <span class="n">broker</span><span class="o">.</span><span class="n">setcommission</span><span class="p">(</span><span class="o">**</span><span class="n">commkwargs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">getdatas</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="c1"># Get the data feed class from the global dictionary</span>
    <span class="n">dfcls</span> <span class="o">=</span> <span class="n">DATAFORMATS</span><span class="p">[</span><span class="n">args</span><span class="o">.</span><span class="n">csvformat</span><span class="p">]</span>

    <span class="c1"># Prepare some args</span>
    <span class="n">dfkwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">csvformat</span> <span class="o">==</span> <span class="s1">&#39;yahoo_unreversed&#39;</span><span class="p">:</span>
        <span class="n">dfkwargs</span><span class="p">[</span><span class="s1">&#39;reverse&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="n">fmtstr</span> <span class="o">=</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">fromdate</span><span class="p">:</span>
        <span class="n">dtsplit</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">fromdate</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtsplit</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">fmtstr</span> <span class="o">+=</span> <span class="s1">&#39;T%H:%M:%S&#39;</span>

        <span class="n">fromdate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">fromdate</span><span class="p">,</span> <span class="n">fmtstr</span><span class="p">)</span>
        <span class="n">dfkwargs</span><span class="p">[</span><span class="s1">&#39;fromdate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fromdate</span>

    <span class="n">fmtstr</span> <span class="o">=</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">todate</span><span class="p">:</span>
        <span class="n">dtsplit</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">todate</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtsplit</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">fmtstr</span> <span class="o">+=</span> <span class="s1">&#39;T%H:%M:%S&#39;</span>
        <span class="n">todate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">todate</span><span class="p">,</span> <span class="n">fmtstr</span><span class="p">)</span>
        <span class="n">dfkwargs</span><span class="p">[</span><span class="s1">&#39;todate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">todate</span>

    <span class="n">datas</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">dname</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
        <span class="n">dfkwargs</span><span class="p">[</span><span class="s1">&#39;dataname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dname</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">dfcls</span><span class="p">(</span><span class="o">**</span><span class="n">dfkwargs</span><span class="p">)</span>
        <span class="n">datas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">datas</span>


<span class="k">def</span> <span class="nf">getmodclasses</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">clstype</span><span class="p">,</span> <span class="n">clsname</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">clsmembers</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">)</span>

    <span class="n">clslist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">cls</span> <span class="ow">in</span> <span class="n">clsmembers</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">clstype</span><span class="p">):</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">clsname</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">clsname</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="n">clslist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">clslist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">clslist</span>


<span class="k">def</span> <span class="nf">loadmodule</span><span class="p">(</span><span class="n">modpath</span><span class="p">,</span> <span class="n">modname</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="c1"># generate a random name for the module</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">modname</span><span class="p">:</span>
        <span class="n">chars</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_uppercase</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span>
        <span class="n">modname</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">chars</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

    <span class="n">version</span> <span class="o">=</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
        <span class="n">mod</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">loadmodule2</span><span class="p">(</span><span class="n">modpath</span><span class="p">,</span> <span class="n">modname</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mod</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">loadmodule3</span><span class="p">(</span><span class="n">modpath</span><span class="p">,</span> <span class="n">modname</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mod</span><span class="p">,</span> <span class="n">e</span>


<span class="k">def</span> <span class="nf">loadmodule2</span><span class="p">(</span><span class="n">modpath</span><span class="p">,</span> <span class="n">modname</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">imp</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">load_source</span><span class="p">(</span><span class="n">modname</span><span class="p">,</span> <span class="n">modpath</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">loadmodule3</span><span class="p">(</span><span class="n">modpath</span><span class="p">,</span> <span class="n">modname</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">importlib.machinery</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">machinery</span><span class="o">.</span><span class="n">SourceFileLoader</span><span class="p">(</span><span class="n">modname</span><span class="p">,</span> <span class="n">modpath</span><span class="p">)</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">load_module</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">getstrategy</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="n">sttokens</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sttokens</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">modpath</span> <span class="o">=</span> <span class="n">sttokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">stname</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">modpath</span><span class="p">,</span> <span class="n">stname</span> <span class="o">=</span> <span class="n">sttokens</span>

    <span class="k">if</span> <span class="n">modpath</span><span class="p">:</span>
        <span class="n">mod</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">loadmodule</span><span class="p">(</span><span class="n">modpath</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">mod</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Failed to load module </span><span class="si">%s</span><span class="s1">:&#39;</span> <span class="o">%</span> <span class="n">modpath</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="n">btstrats</span>

    <span class="n">strats</span> <span class="o">=</span> <span class="n">getmodclasses</span><span class="p">(</span><span class="n">mod</span><span class="o">=</span><span class="n">mod</span><span class="p">,</span> <span class="n">clstype</span><span class="o">=</span><span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">,</span> <span class="n">clsname</span><span class="o">=</span><span class="n">stname</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">strats</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;No strategy </span><span class="si">%s</span><span class="s1"> / module </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">stname</span><span class="p">),</span> <span class="n">modpath</span><span class="p">))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">strats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">getanalyzers</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="n">analyzers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">anspec</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">analyzers</span> <span class="ow">or</span> <span class="p">[]:</span>

        <span class="n">tokens</span> <span class="o">=</span> <span class="n">anspec</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">modpath</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">modpath</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">tokens</span>

        <span class="k">if</span> <span class="n">modpath</span><span class="p">:</span>
            <span class="n">mod</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">loadmodule</span><span class="p">(</span><span class="n">modpath</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">mod</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Failed to load module </span><span class="si">%s</span><span class="s1">:&#39;</span> <span class="o">%</span> <span class="n">modpath</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mod</span> <span class="o">=</span> <span class="n">btanalyzers</span>

        <span class="n">loaded</span> <span class="o">=</span> <span class="n">getmodclasses</span><span class="p">(</span><span class="n">mod</span><span class="o">=</span><span class="n">mod</span><span class="p">,</span> <span class="n">clstype</span><span class="o">=</span><span class="n">bt</span><span class="o">.</span><span class="n">Analyzer</span><span class="p">,</span> <span class="n">clsname</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">loaded</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;No analyzer </span><span class="si">%s</span><span class="s1"> / module </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">modpath</span><span class="p">)))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">analyzers</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">loaded</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">analyzers</span>


<span class="k">def</span> <span class="nf">getobservers</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="n">observers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">obspec</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">observers</span> <span class="ow">or</span> <span class="p">[]:</span>

        <span class="n">tokens</span> <span class="o">=</span> <span class="n">obspec</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">modpath</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">modpath</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">tokens</span>

        <span class="k">if</span> <span class="n">modpath</span><span class="p">:</span>
            <span class="n">mod</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">loadmodule</span><span class="p">(</span><span class="n">modpath</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">mod</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Failed to load module </span><span class="si">%s</span><span class="s1">:&#39;</span> <span class="o">%</span> <span class="n">modpath</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mod</span> <span class="o">=</span> <span class="n">btobs</span>

        <span class="n">loaded</span> <span class="o">=</span> <span class="n">getmodclasses</span><span class="p">(</span><span class="n">mod</span><span class="o">=</span><span class="n">mod</span><span class="p">,</span> <span class="n">clstype</span><span class="o">=</span><span class="n">bt</span><span class="o">.</span><span class="n">Observer</span><span class="p">,</span> <span class="n">clsname</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">loaded</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;No observer </span><span class="si">%s</span><span class="s1"> / module </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">modpath</span><span class="p">)))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">observers</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">loaded</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">observers</span>


<span class="k">def</span> <span class="nf">parse_args</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Backtrader Run Script&#39;</span><span class="p">)</span>

    <span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Data options&#39;</span><span class="p">)</span>
    <span class="c1"># Data options</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--data&#39;</span><span class="p">,</span> <span class="s1">&#39;-d&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;append&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                       <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Data files to be added to the system&#39;</span><span class="p">)</span>

    <span class="n">datakeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">DATAFORMATS</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--csvformat&#39;</span><span class="p">,</span> <span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                       <span class="n">default</span><span class="o">=</span><span class="s1">&#39;btcsv&#39;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">datakeys</span><span class="p">,</span>
                       <span class="n">help</span><span class="o">=</span><span class="s1">&#39;CSV Format&#39;</span><span class="p">)</span>

    <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--fromdate&#39;</span><span class="p">,</span> <span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                       <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Starting date in YYYY-MM-DD[THH:MM:SS] format&#39;</span><span class="p">)</span>

    <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--todate&#39;</span><span class="p">,</span> <span class="s1">&#39;-t&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                       <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Ending date in YYYY-MM-DD[THH:MM:SS] format&#39;</span><span class="p">)</span>

    <span class="c1"># Module where to read the strategy from</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Strategy options&#39;</span><span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--strategy&#39;</span><span class="p">,</span> <span class="s1">&#39;-st&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                       <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Module and strategy to load with format &#39;</span>
                             <span class="s1">&#39;module_path:strategy_name.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;module_path:strategy_name will load &#39;</span>
                             <span class="s1">&#39;strategy_name from the given module_path</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;module_path will load the module and return &#39;</span>
                             <span class="s1">&#39;the first available strategy in the module</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;:strategy_name will load the given strategy &#39;</span>
                             <span class="s1">&#39;from the set of built-in strategies&#39;</span><span class="p">))</span>

    <span class="c1"># Observers</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Observers and statistics&#39;</span><span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--nostdstats&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                       <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Disable the standard statistics observers&#39;</span><span class="p">)</span>

    <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--observer&#39;</span><span class="p">,</span> <span class="s1">&#39;-ob&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;observers&#39;</span><span class="p">,</span>
                       <span class="n">action</span><span class="o">=</span><span class="s1">&#39;append&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                       <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;This option can be specified multiple times</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;Module and observer to load with format &#39;</span>
                             <span class="s1">&#39;module_path:observer_name.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;module_path:observer_name will load &#39;</span>
                             <span class="s1">&#39;observer_name from the given module_path</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;module_path will load the module and return &#39;</span>
                             <span class="s1">&#39;all available observers in the module</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;:observer_name will load the given strategy &#39;</span>
                             <span class="s1">&#39;from the set of built-in strategies&#39;</span><span class="p">))</span>

    <span class="c1"># Anaylzers</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Analyzers&#39;</span><span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--analyzer&#39;</span><span class="p">,</span> <span class="s1">&#39;-an&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;analyzers&#39;</span><span class="p">,</span>
                       <span class="n">action</span><span class="o">=</span><span class="s1">&#39;append&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                       <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;This option can be specified multiple times</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;Module and analyzer to load with format &#39;</span>
                             <span class="s1">&#39;module_path:analzyer_name.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;module_path:analyzer_name will load &#39;</span>
                             <span class="s1">&#39;observer_name from the given module_path</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;module_path will load the module and return &#39;</span>
                             <span class="s1">&#39;all available analyzers in the module</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;:anaylzer_name will load the given strategy &#39;</span>
                             <span class="s1">&#39;from the set of built-in strategies&#39;</span><span class="p">))</span>

    <span class="c1"># Broker/Commissions</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Cash and Commission Scheme Args&#39;</span><span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--cash&#39;</span><span class="p">,</span> <span class="s1">&#39;-cash&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                       <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Cash to set to the broker&#39;</span><span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--commission&#39;</span><span class="p">,</span> <span class="s1">&#39;-comm&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                       <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Commission value to set&#39;</span><span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--margin&#39;</span><span class="p">,</span> <span class="s1">&#39;-marg&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                       <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Margin type to set&#39;</span><span class="p">)</span>

    <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--mult&#39;</span><span class="p">,</span> <span class="s1">&#39;-mul&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                       <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Multiplier to use&#39;</span><span class="p">)</span>

    <span class="c1"># Plot options</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Plotting options&#39;</span><span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--noplot&#39;</span><span class="p">,</span> <span class="s1">&#39;-np&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                       <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Do not plot the read data&#39;</span><span class="p">)</span>

    <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--plotstyle&#39;</span><span class="p">,</span> <span class="s1">&#39;-ps&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span>
                       <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="s1">&#39;candle&#39;</span><span class="p">],</span>
                       <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Plot style for the input data&#39;</span><span class="p">)</span>

    <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--plotfigs&#39;</span><span class="p">,</span> <span class="s1">&#39;-pn&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                       <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Plot using n figures&#39;</span><span class="p">)</span>

    <span class="c1"># Extra arguments</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;args&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">REMAINDER</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;args to pass to the loaded strategy&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">runstrat</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>

  <div class="section">
  
    


<div class="section">
  <span style="float: left;">
  
  
  <a href="../../2015-08-12-observers-and-statistics/observers-and-statistics/">
    <i class="fa fa-arrow-circle-left"></i>
    Observers and Statistics
  </a>
  
  </span>
  <span>&nbsp;</span>
  <span style="float: right;">
  
  
  <a href="../../2015-08-21-pandas-datafeed/pandas-datafeed/">
    Pandas DataFeed Support
    <i class="fa fa-arrow-circle-right"></i>
  </a>
  </span>
  
</div>

  
  
    <div class="section">
    <h2>Comments</h2>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'backtrader'; // required: replace example with your forum shortname
        var disqus_identifier = '/posts/2015-08-16-backtesting-with-almost-no-programming/backtesting-with-almost-no-programming/';
        var disqus_title = 'Automating &lt;code class=&#34;docutils literal&#34;&gt;&lt;span class=&#34;pre&#34;&gt;backtrader&lt;/span&gt;&lt;/code&gt; BackTesting';
        var disqus_url = 'http://blog.backtrader.com/posts/2015-08-16-backtesting-with-almost-no-programming/backtesting-with-almost-no-programming';
        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  
  </div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../">backtrader</a></h1>





<p>
<iframe src="https://ghbtns.com/github-btn.html?user=mementum&repo=backtrader&type=watch&count=true&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>




    

<p>
<a href="https://travis-ci.org/mementum/backtrader">
    <img
        alt="https://secure.travis-ci.org/mementum/backtrader.png?branch=master"
        src="https://secure.travis-ci.org/mementum/backtrader.png?branch=master"
    />
</a>
</p>



  
  
  <h2>
  
  <i class="fa fa-calendar"></i>
    Aug 16, 2015
  
  </h2>

  <ul>
    
  <li><i class="fa fa-pencil-square-o"></i>
    Aug 22, 2015</li>
  

  
  <li><i class="fa-fw fa fa-user"></i>
    
      
      <a href="../../../blog/author/mementum/">mementum</a>
      
    </li>
  

  

  

  

  
  
  <li>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'backtrader'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
    <i class="fa-fw fa fa-comments"></i>
    <a href="#disqus_thread" data-disqus-identifier="/posts/2015-08-16-backtesting-with-almost-no-programming/backtesting-with-almost-no-programming/"> </a>
  </li>
  
  </ul>


<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../about/">About backtrader</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about/#documentation">Documentation</a></li>
</ul>


  <h3><a href="../../../blog/">Recent Posts</a></h3>
  <ul>
    
    
      <li><a href="../../2016-09-17-notebook-inline/notebook-inline/">Sep 17 - Notebook - Automatic Inline Plotting</a></li>
    
      <li><a href="../../2016-09-17-data-synchronization/data-synchronization/">Sep 17 - Data Synchronization Rework</a></li>
    
      <li><a href="../../2016-09-06-vwr/vwr/">Sep 06 - Variability Weighted Return (or VWR)</a></li>
    
      <li><a href="../../2016-09-05-optimization-improvements/optimization-improvements/">Sep 05 - Optimization improvements</a></li>
    
      <li><a href="../../2016-09-02-target-orders/target-orders/">Sep 02 - Target Orders</a></li>
    
  </ul>

  <h3><a href="../../../blog/archive/">Archives</a></h3>
  <ul>
  
    
    <li><a href="../../../blog/2016/">2016 (28)</a></li>
    
  
    
    <li><a href="../../../blog/2015/">2015 (27)</a></li>
    
  
  </ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, mementum.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.7</a>
      
      |
      <a href="../../../_sources/posts/2015-08-16-backtesting-with-almost-no-programming/backtesting-with-almost-no-programming.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/mementum/backtrader" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-2435868-6']);
      _gaq.push(['_setDomainName', 'none']);
      _gaq.push(['_setAllowLinker', true]);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
    
  </body>
</html>